@if(isLoading){
  <app-loading></app-loading>
}

<ion-header>
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button routerLink="/home">
        <ion-icon name="home-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <img slot="start" src="assets/images/logo1.png" alt="App Logo" class="app-logo" />
    <ion-title slot="start">AI Outfit Studio ðŸ‘•</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="modern-page" dir="ltr">
  <div class="upload-container">
    <h2 class="page-title" style="text-align: center;">Upload Your Photo ðŸ“¸</h2>

    <!-- ðŸ“¸ User Photo Upload -->
    <div class="upload-area">
      <label for="userUpload" class="upload-label">
        <ion-icon name="cloud-upload-outline" class="upload-icon"></ion-icon>
        <span class="upload-text">Choose Your Photo</span>
      </label>
      <input id="userUpload"
             type="file"
             accept="image/*"
             (change)="onUserFileSelected($event)"
             class="file-input"
             #userFileInput />
    </div>

    <!-- ðŸ” Preview (User / Processed) -->
    <div *ngIf="previewUser" class="card preview-card hero-preview">
      <div class="image-wrapper" [class.result-mode]="processedPreview">
        <img [src]="processedPreview ? processedPreview : previewUser"
             class="preview-image hero-image"
             alt="Main Image"/>

        <img *ngIf="processedPreview"
             [src]="previewUser"
             class="original-thumb"
             alt="Original Thumbnail"/>

        <a *ngIf="processedPreview"
           [href]="processedPreview"
           download="processed-image.jpg"
           class="save-icon"
           title="Save image"
           target="_blank">
          <ion-icon name="download-outline"></ion-icon>
        </a>
      </div>

<div class="mode-toggle">
  <span class="label-text">Let AI harmonize outfit and background</span>
  <ion-toggle [(ngModel)]="isCreativeMode" name="creativeMode" mode="ios"></ion-toggle>
</div>


        <!-- <ion-card class="param-card">
          <ion-card-header><ion-card-title>Output Mode</ion-card-title></ion-card-header>
          <ion-card-content>
            <ion-segment [value]="outputMode" (ionChange)="onOutputModeChange($event)">
              <ion-segment-button value="single"><ion-label>Single</ion-label></ion-segment-button>
              <ion-segment-button value="four-view"><ion-label>Three Views</ion-label></ion-segment-button>
            </ion-segment>
          </ion-card-content>
        </ion-card> -->


      <ion-button expand="block"
                  class="upload-btn"
                  (click)="uploadFile()"
                  [disabled]="!hasAnySelection()">
        Upload & Process
      </ion-button>
    </div>

    <!-- ðŸ”¹ Men Categories (horizontal tabs) -->
    <div class="category-tabs">
      <div *ngFor="let cat of girlCategories"
           (click)="toggleCategory(cat.key)"
           [class.active]="activeCategory === cat.key"
           class="tab-item">
        <img [src]="cat.icon" [alt]="cat.label" />
        <p>{{ cat.label }}</p>
      </div>
    </div>

    <!-- ðŸ”¸ Styles Grid for Active Category -->
    <div *ngIf="activeCategory" class="style-grid">
      <div class="category-header">
        <span>{{ activeCategoryLabel }}</span>
      </div>

      <div class="style-grid-inner">
        <div *ngFor="let style of getStylesForActiveCategory()"
             (click)="toggleStyle(style)"
             class="style-card"
             [class.selected]="selectedStyles[activeCategory]?.name === style.name">
          <img [src]="style.image" [alt]="style.name" />
          <p>{{ style.name }}</p>
        </div>
      </div>

      <!-- ðŸŽ¨ Color Picker per Category -->
  <ion-card class="param-card" style="margin-top:14px; margin-bottom: 100px;">
  <ion-card-header>
    <ion-card-title>Colors for {{ activeCategoryLabel }}</ion-card-title>
  </ion-card-header>
<ion-card-content>
  <!-- ðŸŽ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù†Ú¯ -->
  <div class="btn-group" style="justify-content:flex-start; gap:10px; align-items:center;">
    <input
      type="color"
      [value]="getActiveCategoryColor()"
      (change)="onSingleColorPicked(activeCategory, $event)"
      class="color-input"
    />

    <ion-button
      *ngIf="colorPalettes[activeCategory]?.length"
      size="small"
      color="danger"
      fill="outline"
      (click)="removeSingleColorForCategory(activeCategory)"
    >
      Remove Color
    </ion-button>
  </div>

  <!-- Ù†Ù…Ø§ÛŒØ´ Ø±Ù†Ú¯ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ -->
  <div
    class="color-preview"
    *ngIf="colorPalettes[activeCategory]?.length"
    style="margin-top:10px;"
  >
    <div
      class="color-dot"
      [style.background]="colorPalettes[activeCategory][0]"
      [title]="colorPalettes[activeCategory][0]"
      style="cursor:pointer;"
    ></div>
    <ion-note color="medium" style="display:block; margin-top:6px;">
      Current color: {{ colorPalettes[activeCategory][0] }}
    </ion-note>
  </div>
</ion-card-content>

</ion-card>

    </div>
  </div>
</ion-content>
